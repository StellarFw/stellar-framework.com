---
title: Actions
type: guide
order: 3
---

## What is an Action?

Actions are the building blocks of Stellar, this is the basic unit of the Framework. Stellar being an actions base framework that means there is a repository with all actions registered in the project. An action is a small feature of the project, they can be called directly by the client or internally by other actions. The actions can receive a set of inputs who after processing return a set of outputs. These action can be private and can only be called by other actions and not by the client and can also be overridden by other modules, unless they are protected.

The developers can create their own actions by creating a new file in the module's `actions` folder where you are working, or makes use of the command-line tool to generate the file and the structure automatically (`stellar makeAction <nome_da_action> --module=<modulo_onde_criar_a_ação>`).

The actions are loaded to the Engine when it starts, the actions can be called in any place, including in other modules.

```javascript
exports.randomNumber = {
  name: 'randomNumber',
  description: 'Generate a random number',
  outputExample: {
    number: 0.40420848364010453
  },

  run: (api, action, next) => {
    // generate a random number
    var number = Math.random()

    // save the generated number like an output parameter
    action.response.number = number

    // returns a formated string
    action.response.formatedNumber = `Your random number is ${number}`

    // finish the action execution
    next()
  }
}
```

The actions are composed of two mandatory properties, one is the identification of the action (`name`), the other is the action logic (`run(api, action, next)`), but these can contain a lot more additional information such as a description, restrictions to the input values, middleware, and an output example. With this metadata Stellar is able to generate gully automatic documentation without human interaction. This is excellent to bug teams since all elements can easily get to know all the project's features without having to constantly be asking to other team members.

On the code snippet above you can see the structure of an action, this action is responsible to generate a random number.

The actions are asynchronous and receive a reference for the API (shared functions of the Engine), an object with the actions, and a callback function. To complete the execution of an action simply call the `next(error)` function. If exist an error, you have to ensure that it passes an instance of `Error` and not a `String` as the argument of the `next` function, an error message will be generated that will be sent to the client.

Because of the anatomy of actions, these can be called by the client or internally by other actions, without the need to change or write specific code for each usage scenario.

## Properties

There is a set of options who can be added  to actions, below are listed and described all the options available:

- **`name`**: unique action identifier. It is recommended to use a namespace to eliminate  the possibility of collision, for example: `auth::login`;
- **`description`**: Describes extensively the action, this information is important for automatic documentation;
- **`inputs`**: Enumerates the action input parameters. You can also apply restrictions on input values;
- **`middleware`**: Indicates the middleware to be applied before and after the execution of the action. Global middleware are automatically applied;
- **`outputExample`**: It contains an example of an action response. This example will be automatically attached to the documentation generated by Stellar;
- **`blockedConnectionTypes`**: Allows block types of connections;
- **`logLevel`**: It allows you define how the action should be logged;
- **`protected`**: When `true` prevents the action to be overwrite by a higher priority module;
- **`private`**: The action can only be called internally;
- **`toDocument`**: By default, this option is set to `true`, otherwise will not be generated documentation for this action;
- **`run`**: Finally, the logic of action, it is a function who receives three input parameters `(api, action, next)`.

> Note: Some of the metadata, as the case of `outputExample` and `description`, are used to feed the automatic documentation.

## Versions

Stellar supports multiple versions if the same action. This allows support actions with the same name, but with improved features. This feature is useful when there are many client applications that are feed from the API, in this cases you can update your applications without fear of break outdated version and individually update to the new API without service interruption in other applications.

Actions can optionally contain the `version` parameter to define the version of it. When a client para a request he can set the `apiversion` parameter to ask for a specific version of the action.

> Note: When no `apiVersion` parameter is defined, Stellar will respond with the latest version of the action.

##  Input Declaration

In the action declaration you can give the input specify the input fields using the `inputs` property, this will apply restrictions to the inputed valued. These restrictions can be validators already defined in the system, a regular expression or a function who returns an `boolean` (where `true` indicates that the input value is valid). Finally, you can also convert input values to a specific data type (integer, float, and string) or use a function to format the value.

The list below shows all available options to use on the input declaration:

- **`required`**: this fields indicated if the parameter is required;
- **`convert`**: allows you to convert the parameter to a specific data type or format;
- **`default`**: default value if the parameter is not present in the set of inputs on the client call;
- **`validator`**: validates the parameter, it has one or a set of constraints.

## Converter Parameters

To remove the need for developers to manually convert the parameters, Stellar implements a way to automatically do before performing the action. The `convert` property can be a string with the values (`string`, `integer` or `float`) or a function (`(api, value)`).

### Example

The example below shows the conversion of a parameter to the integer type:

```javascript
exports.giveAge = {
  name: 'giveAge',
  description: 'Give the name and age based on the year of birth',

  inputs: {
    name: {
      required: true
    },
    birthYear: {
      required: true,
      convertTo: ‘integer’
    }
  },

  run: (api, action, next) => {
    // calculate the person age (birthYear is already a number)
    let age = new Date().getFullYear() - action.params.birthYear

    // return a phrase with the name and age
    action.response.result = `${action.params.name} has ${age}`

    // finish the action execution
    next()
  }
}
```

## Action Parameter

The second parameter of the `run` function is the `action` object. This object passes into the action captures the state of the connection at the time the action was stated. Middleware preProcessors have already fired, and input formatting and validation has occurred. The image bellow show some of the properties of the `action` object:

![Propriedades do Objeto Action](/images/action_obj.png)

The goal of most actions is to perform a series of operations and change the `data.response` property, which will later be sent to the client. You can modify the connection properties by accessing `data.connection`, and change, for example, the HTTP headers. If you do not want the Engine to send a response to the client (for example, it has already sent a file), just have to set the `data.toRender` para `false`.

## Internal Calls

In order to improve the reuse of code and do a better separation of the actions that share part of same logic, the Stellar implements a mechanism to make internal calls to actions. This means that you can extract part of the logic of one (or more) actions for simple actions, which may be the same logic used by other actions. So, from the composition of simple actions you can create more complex actions without making the code readability more complex or difficult to maintain both applications and modules.

The call an action internally you can use the `api.actions.call(actionName, params, callback)` method:

- **`actionName`**: action name to call;
- **`params`**: parameter to be passed to the action that will be performed;
- **`callback(**error, response)`: callback function:
  - **`error`**: error returned by the action call;
  - **`response`**: object with the action response.

### Private Actions

Sometimes actions will be create actions do you not want to be called by clients, because they are for internal use only. They don't provide useful operations to the clients, are simple actions or critical who should not have public exposure. For that Stellar allows you to define an action as private, so this can only be called internally. To make a private action just add the `private: true` property in the target action.

### Example

The example bellow shows an internal call to an action called `sumANumber`, after the execution the result is printed out to the console. The complete example can be found [here](https://github.com/gil0mendes/stellar/blob/dev/example/modules/test/actions/internalCalls.js).

```javascript
api.actions.call('sumANumber', {a: 3, b: 3}, (error, response) => {
  console.log(`Result => ${response.formatted}`)
})
```

> Note: you can also call actions on tasks or listeners.

## Automatic Documentation

Stellar can generate documentation fully automatically. The required information is extracted through the declaration of the actions properties. To make it not generate documentation you must add the `toDocument: false` on the action in question, if you want disable to all actions you need set the `api.config.general.generateDocumentation` to `false`. To access the documentation just visit the address `docs/index.html` in the HTTP server address.

![Automatic Documentation](/images/auto_docs.png)

The image above shows an example of an automatically generated documentation. In the sidebar are all existing actions in the platform, including private actions. In the section on the right you can see the action selected details such as name, description, input fields and their restrictions ans as well an output example. When actions have multiple versions all of them are displayed.

## Middleware

You can apply middleware in the actions (before and after the implementation thereof). The middleware can be global (applied to all actions) or sites specifically for each action through the middleware property, providing the name of each middleware to apply to that action.

You can learn more about [middleware here](middleware.html).

### Example

The following example shows the declaration of an action that contains two middleware:

```javascript
exports.getAllAccounts = {
  name: 'getAllAccounts',
  description: 'Get all registered accounts',

  middleware: ['auth', 'superResponse'],

  run: (api, action, next) => {
    // perforce some operation...

    // finish action execution
    next()
  }
}
```
