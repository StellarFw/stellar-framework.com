
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Middleware - Stellar</title>
    <meta charset="utf-8">
    <meta name="description" content="Stellar is an action based web framework for creating Web APIs easily!">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Middleware - Stellar">
    <meta property="og:description" content="Stellar is an action based web framework for creating Web APIs easily!">
    <meta property="og:image" content="https://stellar-framework.com/images/logo.png">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Middleware - Stellar">
    <meta name="twitter:description" content="Stellar is an action based web framework for creating Web APIs easily!">
    <meta name="twitter:image" content="https://stellar-framework.com/images/logo.png">

    <link rel="icon" href="/images/logo.png" type="image/x-icon">

    <!-- color to use by the browsers -->
    <meta name="theme-color" content="#98588C">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Roboto Mono' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Dosis:500' rel='stylesheet' type='text/css'>

    <!-- main page styles -->
    <link rel="stylesheet" href="/css/page.css">

    <!-- this needs to be loaded before guide's inline scripts -->
    <script>window.PAGE_TYPE = 'guide'</script>

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NSK9WJ6');</script>
    <!-- End Google Tag Manager -->
  </head>
  <body class="docs">    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NSK9WJ6"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div id="mobile-bar" >
      <a class="menu-button"></a>
      <a class="logo" href="/"></a>
    </div>

    <div id="header">
    <a id="logo" href="/">
        <img src="/images/logo.png">
        <span>Stellar</span>
    </a>
    <ul id="nav">
        <li>
  <form id="search-form">
    <input type="text" id="search-query-nav" class="search-query st-default-search-input">
  </form>
</li>
<li><a href="/guide/" class="nav-link current">Guide</a></li>
<li class="nav-dropdown-container">
  <a class="nav-link">Community</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://github.com/stellarFw/stellar" class="nav-link" target="_blank">GitHub</a></li>
    <li><a href="https://gitter.im/StellarFw/StellarFw" class="nav-link" target="_blank">Chat</a></li>
    <li><a href="https://twitter.com/gil0mendes" class="nav-link" target="_blank">Twitter</a></li>
  </ul>
</li>

<li class="nav-dropdown-container ecosystem">
  <a class="nav-link">Ecosystem</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://github.com/StellarFw/Identify" class="nav-link" target="_blank">Identify</a></li>
  </ul>
</li>


    </ul>
</div>

    
      <div id="main" class="fix-sidebar">
        
          
  <div class="sidebar">
  <ul class="main-menu">
    <li>
  <form id="search-form">
    <input type="text" id="search-query-sidebar" class="search-query st-default-search-input">
  </form>
</li>
<li><a href="/guide/" class="nav-link current">Guide</a></li>
<li class="nav-dropdown-container">
  <a class="nav-link">Community</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://github.com/stellarFw/stellar" class="nav-link" target="_blank">GitHub</a></li>
    <li><a href="https://gitter.im/StellarFw/StellarFw" class="nav-link" target="_blank">Chat</a></li>
    <li><a href="https://twitter.com/gil0mendes" class="nav-link" target="_blank">Twitter</a></li>
  </ul>
</li>

<li class="nav-dropdown-container ecosystem">
  <a class="nav-link">Ecosystem</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://github.com/StellarFw/Identify" class="nav-link" target="_blank">Identify</a></li>
  </ul>
</li>


  </ul>
  <div class="list">
    <div class="main-sponsor"></div>
    <a class="become-backer" href="/support-stellar">
      Become a Backer
    </a>

    <ul class="menu-root">
      
        
        
          
        

        <li>
          <a href="/guide/index.html" class="sidebar-link">Overview</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/installation.html" class="sidebar-link">Installation</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/actions.html" class="sidebar-link">Actions</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/tasks.html" class="sidebar-link">Tasks</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/middleware.html" class="sidebar-link current">Middleware</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/satellites.html" class="sidebar-link">Satellites</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/cluster.html" class="sidebar-link">Cluster</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/cache.html" class="sidebar-link">Cache</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/chat.html" class="sidebar-link">Chat</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/development_mode.html" class="sidebar-link">Development Mode</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/file_system.html" class="sidebar-link">File System</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/events.html" class="sidebar-link">Events</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/websocket.html" class="sidebar-link">WebSocket</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/tcp.html" class="sidebar-link">TCP</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/http.html" class="sidebar-link">HTTP</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/security.html" class="sidebar-link">Security</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/validation.html" class="sidebar-link">Validation</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/logging.html" class="sidebar-link">Logging</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/commands.html" class="sidebar-link">Commands</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/testing.html" class="sidebar-link">Testing</a>
        </li>
      
        
        
          
            <li><h3>Models</h3></li>
          
        

        <li>
          <a href="/guide/models.html" class="sidebar-link">Introduction</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/models-data_types.html" class="sidebar-link">Data Types and Attributes</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/models-validations.html" class="sidebar-link">Validations</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/models-instance.html" class="sidebar-link">Instance and Class Methods</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/models-associations.html" class="sidebar-link">Associations</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/models-configurations.html" class="sidebar-link">Model Configuration</a>
        </li>
      
        
        
          
        

        <li>
          <a href="/guide/models-queries.html" class="sidebar-link">Queries</a>
        </li>
      
    </ul>
  </div>
</div>



<div class="content guide with-sidebar middleware-guide">
  
    <h1>Middleware</h1>
  

  <h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>Developers can create middleware that can be applied before and after the execution of an action. There are two types of middleware: global middleware, which is applied to all actions, and individual middleware, which is applied individually to each action using the <code>middleware</code> property. Each middleware component has a priority that will set the execution order of the middleware.  Middleware can also be classified as <em>Action Middleware</em>, <em>Connection Middleware</em>, or <em>Chat Middleware</em>.  Each is distinct from the other and operates in different parts of the connection lifecycle.</p>
<h3 id="Lifecycle"><a href="#Lifecycle" class="headerlink" title="Lifecycle"></a>Lifecycle</h3><div style="margin-left: auto; margin-right: auto; max-width: 80%;"><br>  <img src="/images/middleware_lifecycle.png" alt="Request Flow"><br></div>

<p>As can be seen in the image above, there are a number of different places where you can run middleware. The following list shows the different middleware available on Stellar:</p>
<ul>
<li>When a client connects<ul>
<li>connection middleware, <code>create</code></li>
</ul>
</li>
<li>When a client makes a request to an action<ul>
<li>action middleware, <code>preProcessor</code></li>
<li>action middleware, <code>postProcessor</code></li>
</ul>
</li>
<li>When a client joins to a chat room<ul>
<li>chat middleware, <code>join</code></li>
</ul>
</li>
<li>When a client sends a message to a chat room<ul>
<li>chat middleware, <code>say</code></li>
<li>chat middleware, <code>onSayReceive</code></li>
</ul>
</li>
<li>When a client makes a request to disconnect (<em>quit</em>)<ul>
<li>chat middleware, <code>leave</code></li>
<li>connection middleware, <code>destroy</code></li>
</ul>
</li>
</ul>
<h2 id="Types-of-Middleware"><a href="#Types-of-Middleware" class="headerlink" title="Types of Middleware"></a>Types of Middleware</h2><h3 id="Action-Middleware"><a href="#Action-Middleware" class="headerlink" title="Action Middleware"></a>Action Middleware</h3><p>Stellar offers hooks to execute code before and after specified actions; this is the appropriate place to add logic related to authentication or to validate the state of a given resource.</p>
<h3 id="Connection-Middleware"><a href="#Connection-Middleware" class="headerlink" title="Connection Middleware"></a>Connection Middleware</h3><p>You can create middleware to react to the creation and destruction of all connections. Unlike action middleware, they are asynchronous and do not block the request until they finish executing.</p>
<p>Keep in mind that some connections persist (WebSocket, TCP) and some only exist for the duration of a single request (web). You will likely want to inspect <code>connection.type</code> in this middleware. If you do not provide a priority, the default from <code>api.config.general.defaultProcessorPriority</code> will be used.</p>
<h3 id="Chat-Middleware"><a href="#Chat-Middleware" class="headerlink" title="Chat Middleware"></a>Chat Middleware</h3><p>The last type of middleware is used to act when a connection joins, leaves, or communicates within a chat room. We have 4 types of middleware for each step: <code>say</code>, <code>onSayReceive</code>, <code>join</code> and <code>leave</code>.</p>
<p>Priority is optional in all cases, but can be used to order your middleware. If an error is returned by any of these methods, it will be returned to the user, and the action/message will not be sent.</p>


  
      <div class="guide-links">
        
          <span>← <a href="/guide/tasks.html">Tasks</a></span>
        
        
          <span style="float:right"><a href="/guide/satellites.html">Satellites</a> →</span>
        
      </div>
    

    <div class="footer">
      Caught a mistake or want to contribute to documentation?
      <a href="https://github.com/StellarFw/stellar-framework.com/tree/master/src/guide/middleware.md" target="_blank">
        Edit this page on Github!
      </a>
    </div>
</div>

        
      </div>
      <script src="/js/smooth-scroll.min.js"></script>
    

    <!-- search -->
    <link href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/css/search.css">
    <script src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js" type="text/javascript"></script>

    <!-- main custom script for sidebar and other cool things -->
    <script src="/js/common.js"></script>

    <!-- fastclick  -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        FastClick.attach(document.body)
      }, false)
    </script>
  </body>
</html>
