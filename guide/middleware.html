
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Middleware - Stellar</title>

    <!-- charset -->
    <meta charset="utf-8">

    <!-- description -->
    <meta name="description" content="Stellar is an action based web framework for creating Web APIs easily!">

    <!-- viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <!-- fonts -->
    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,600|Roboto Mono' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Dosis:300,500' rel='stylesheet' type='text/css'>

    <!-- docsearch -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />

    <!-- page type -->
    <script>
      window.PAGE_TYPE = 'guide'
    </script>

    <!-- load page style -->
    <link rel="stylesheet" href="/css/page.css">

    <!-- load Google Analytics -->
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-77611901-1', 'auto');
  ga('send', 'pageview');
</script>

  </head>
  <body>
    <div id="mobile-bar">
      <a class="menu-button"></a>
      <a class="logo" href="/"></a>
    </div>

    
      <div id="header">
    <a id="logo" href="/">
        <img src="/images/logo.png">
        <span>Stellar</span>
    </a>
    <ul id="nav">
        <li>
  <form id="search-form">
    <input type="text" id="search-query-nav" class="search-query st-default-search-input">
  </form>
</li>
<li><a href="/guide/" class="nav-link current">Guide</a></li>
<li><a href="/blog/" class="nav-link">Blog</a></li>
<li class="nav-dropdown-container">
  <a class="nav-link">Community</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://github.com/stellarFw/stellar" class="nav-link" target="_blank">GitHub</a></li>
    <li><a href="https://twitter.com/gil0mendes" class="nav-link" target="_blank">Twitter</a></li>
  </ul>
</li>
    </ul>
</div>

      <div id="main">
        
          
  <div class="sidebar">
  <ul class="main-menu">
    <li>
  <form id="search-form">
    <input type="text" id="search-query-sidebar" class="search-query st-default-search-input">
  </form>
</li>
<li><a href="/guide/" class="nav-link current">Guide</a></li>
<li><a href="/blog/" class="nav-link">Blog</a></li>
<li class="nav-dropdown-container">
  <a class="nav-link">Community</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://github.com/stellarFw/stellar" class="nav-link" target="_blank">GitHub</a></li>
    <li><a href="https://twitter.com/gil0mendes" class="nav-link" target="_blank">Twitter</a></li>
  </ul>
</li>
  </ul>
  <div class="list">
    <div class="list">
      <div id="donate" style="margin-bottom: 20px">
        <span class="wrapper" style="width: 110px">
          <img src="/images/patreon.png">
          <a href="/support-stellar">Support Stellar</a>
        </span>
      </div>
    </div>
    <ul class="menu-root">
      
        <li>
          <a href="/guide/index.html" class="sidebar-link">Overview</a>
        </li>
      
        <li>
          <a href="/guide/installation.html" class="sidebar-link">Installation</a>
        </li>
      
        <li>
          <a href="/guide/actions.html" class="sidebar-link">Actions</a>
        </li>
      
        <li>
          <a href="/guide/tasks.html" class="sidebar-link">Tasks</a>
        </li>
      
        <li>
          <a href="/guide/middleware.html" class="sidebar-link current">Middleware</a>
        </li>
      
        <li>
          <a href="/guide/satellites.html" class="sidebar-link">Satellites</a>
        </li>
      
        <li>
          <a href="/guide/cluster.html" class="sidebar-link">Cluster</a>
        </li>
      
        <li>
          <a href="/guide/cache.html" class="sidebar-link">Cache</a>
        </li>
      
        <li>
          <a href="/guide/chat.html" class="sidebar-link">Chat</a>
        </li>
      
        <li>
          <a href="/guide/development_mode.html" class="sidebar-link">Development Mode</a>
        </li>
      
        <li>
          <a href="/guide/file_system.html" class="sidebar-link">File System</a>
        </li>
      
        <li>
          <a href="/guide/logging.html" class="sidebar-link">Logging</a>
        </li>
      
        <li>
          <a href="/guide/events.html" class="sidebar-link">Events</a>
        </li>
      
        <li>
          <a href="/guide/websocket.html" class="sidebar-link">WebSocket</a>
        </li>
      
        <li>
          <a href="/guide/tcp.html" class="sidebar-link">TCP</a>
        </li>
      
        <li>
          <a href="/guide/http.html" class="sidebar-link">HTTP</a>
        </li>
      
        <li>
          <a href="/guide/security.html" class="sidebar-link">Security</a>
        </li>
      
    </ul>
  </div>
</div>



<div class="content guide with-sidebar">
  <h1>Middleware</h1>
  <h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>Developers can create middleware that can be applied before and after the execution of an action. There are two types of middleware: global middleware, which is applied to all actions, and individual middleware, which is applied individually to each action using the <code>middleware</code> property. Each middleware component has a priority that will set the execution order of the middleware.  Middleware can also be classified as <em>Action Middleware</em>, <em>Connection Middleware</em>, or <em>Chat Middleware</em>.  Each is distinct from the other and operates in different parts of the connection lifecycle.</p>
<h3 id="Lifecycle"><a href="#Lifecycle" class="headerlink" title="Lifecycle"></a>Lifecycle</h3><p><img src="/images/middleware_lifecycle.png" alt="Request Flow"></p>
<p>As can be seen in the image above, there are a number of different places where you can run middleware. The following list shows the different middleware available on Stellar:</p>
<ul>
<li>When a client connects<ul>
<li>connection middleware, <code>create</code></li>
</ul>
</li>
<li>When a client makes a request to an action<ul>
<li>action middleware, <code>preProcessor</code></li>
<li>action middleware, <code>postProcessor</code></li>
</ul>
</li>
<li>When a client joins to a chat room<ul>
<li>chat middleware, <code>join</code></li>
</ul>
</li>
<li>When a client sends a message to a chat room<ul>
<li>chat middleware, <code>say</code></li>
<li>chat middleware, <code>onSayReceive</code></li>
</ul>
</li>
<li>When a client makes a request to disconnect (<em>quit</em>)<ul>
<li>chat middleware, <code>leave</code></li>
<li>connection middleware, <code>destroy</code></li>
</ul>
</li>
</ul>
<h2 id="Types-of-Middleware"><a href="#Types-of-Middleware" class="headerlink" title="Types of Middleware"></a>Types of Middleware</h2><h3 id="Action-Middleware"><a href="#Action-Middleware" class="headerlink" title="Action Middleware"></a>Action Middleware</h3><p>Stellar offers hooks to execute code before and after specified actions; this is the appropriate place to add logic related to authentication or to validate the state of a given resource.</p>
<h3 id="Connection-Middleware"><a href="#Connection-Middleware" class="headerlink" title="Connection Middleware"></a>Connection Middleware</h3><p>You can create middleware to react to the creation and destruction of all connections. Unlike action middleware, they are asynchronous and do not block the request until they finish executing.</p>
<p>Keep in mind that some connections persist (WebSocket, TCP) and some only exist for the duration of a single request (web). You will likely want to inspect <code>connection.type</code> in this middleware. If you do not provide a priority, the default from <code>api.config.general.defaultProcessorPriority</code> will be used.</p>
<h3 id="Chat-Middleware"><a href="#Chat-Middleware" class="headerlink" title="Chat Middleware"></a>Chat Middleware</h3><p>The last type of middleware is used to act when a connection joins, leaves, or communicates within a chat room. We have 4 types of middleware for each step: <code>say</code>, <code>onSayReceive</code>, <code>join</code> and <code>leave</code>.</p>
<p>Priority is optional in all cases, but can be used to order your middleware. If an error is returned by any of these methods, it will be returned to the user, and the action/message will not be sent.</p>


  
      <div class="guide-links">
        
          <span>← <a href="/guide/tasks.html">Tasks</a></span>
        
        
          <span style="float:right"><a href="/guide/satellites.html">Satellites</a> →</span>
        
      </div>
    

    <div class="footer">
      Caught a mistake or want to contribute to documentation?
      <a href="https://github.com/gil0mendes/pt.stellar-framework.com/tree/master/src/guide/middleware.md" target="_blank">
        Edit this page on Github!
      </a>
    </div>
</div>

        
      </div>

      <script src="/js/smooth-scroll.min.js"></script>
      <script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
      <script src="/js/common.js"></script>
    

    <!-- enable FastClick  -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        FastClick.attach(document.body)
      }, false)
    </script>
  </body>
</html>
