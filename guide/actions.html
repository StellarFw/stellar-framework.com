
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Actions - Stellar</title>

    <!-- charset -->
    <meta charset="utf-8">

    <!-- description -->
    <meta name="description" content="Stellar is an action based web framework for creating Web APIs easily!">

    <!-- favicon -->
    <link rel="icon" href="/images/logo.png" type="image/x-icon">

    <!-- viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <!-- fonts -->
    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,600|Roboto Mono' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Dosis:300,500' rel='stylesheet' type='text/css'>

    <!-- docsearch -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />

    <!-- page type -->
    <script>
      window.PAGE_TYPE = 'guide'
    </script>

    <!-- load page style -->
    <link rel="stylesheet" href="/css/page.css">

    <!-- load Google Analytics -->
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-77611901-1', 'auto');
  ga('send', 'pageview');
</script>

  </head>
  <body>
    <div id="mobile-bar">
      <a class="menu-button"></a>
      <a class="logo" href="/"></a>
    </div>

    
      <div id="header">
    <a id="logo" href="/">
        <img src="/images/logo.png">
        <span>Stellar</span>
    </a>
    <ul id="nav">
        <li>
  <form id="search-form">
    <input type="text" id="search-query-nav" class="search-query st-default-search-input">
  </form>
</li>
<li><a href="/guide/" class="nav-link current">Guide</a></li>
<li><a href="/blog/" class="nav-link">Blog</a></li>
<li class="nav-dropdown-container">
  <a class="nav-link">Community</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://github.com/stellarFw/stellar" class="nav-link" target="_blank">GitHub</a></li>
    <li><a href="https://twitter.com/gil0mendes" class="nav-link" target="_blank">Twitter</a></li>
  </ul>
</li>
    </ul>
</div>

      <div id="main">
        
          
  <div class="sidebar">
  <ul class="main-menu">
    <li>
  <form id="search-form">
    <input type="text" id="search-query-sidebar" class="search-query st-default-search-input">
  </form>
</li>
<li><a href="/guide/" class="nav-link current">Guide</a></li>
<li><a href="/blog/" class="nav-link">Blog</a></li>
<li class="nav-dropdown-container">
  <a class="nav-link">Community</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://github.com/stellarFw/stellar" class="nav-link" target="_blank">GitHub</a></li>
    <li><a href="https://twitter.com/gil0mendes" class="nav-link" target="_blank">Twitter</a></li>
  </ul>
</li>
  </ul>
  <div class="list">
    <div class="list">
      <div id="donate" style="margin-bottom: 20px">
        <span class="wrapper" style="width: 110px">
          <img src="/images/patreon.png">
          <a href="/support-stellar">Support Stellar</a>
        </span>
      </div>
    </div>
    <ul class="menu-root">
      
        <li>
          <a href="/guide/index.html" class="sidebar-link">Overview</a>
        </li>
      
        <li>
          <a href="/guide/installation.html" class="sidebar-link">Installation</a>
        </li>
      
        <li>
          <a href="/guide/actions.html" class="sidebar-link current">Actions</a>
        </li>
      
        <li>
          <a href="/guide/models.html" class="sidebar-link">Models</a>
        </li>
      
        <li>
          <a href="/guide/tasks.html" class="sidebar-link">Tasks</a>
        </li>
      
        <li>
          <a href="/guide/middleware.html" class="sidebar-link">Middleware</a>
        </li>
      
        <li>
          <a href="/guide/satellites.html" class="sidebar-link">Satellites</a>
        </li>
      
        <li>
          <a href="/guide/cluster.html" class="sidebar-link">Cluster</a>
        </li>
      
        <li>
          <a href="/guide/cache.html" class="sidebar-link">Cache</a>
        </li>
      
        <li>
          <a href="/guide/chat.html" class="sidebar-link">Chat</a>
        </li>
      
        <li>
          <a href="/guide/development_mode.html" class="sidebar-link">Development Mode</a>
        </li>
      
        <li>
          <a href="/guide/file_system.html" class="sidebar-link">File System</a>
        </li>
      
        <li>
          <a href="/guide/events.html" class="sidebar-link">Events</a>
        </li>
      
        <li>
          <a href="/guide/logging.html" class="sidebar-link">Logging</a>
        </li>
      
        <li>
          <a href="/guide/websocket.html" class="sidebar-link">WebSocket</a>
        </li>
      
        <li>
          <a href="/guide/tcp.html" class="sidebar-link">TCP</a>
        </li>
      
        <li>
          <a href="/guide/http.html" class="sidebar-link">HTTP</a>
        </li>
      
        <li>
          <a href="/guide/security.html" class="sidebar-link">Security</a>
        </li>
      
    </ul>
  </div>
</div>



<div class="content guide with-sidebar">
  <h1>Actions</h1>
  <h2 id="What-is-an-Action"><a href="#What-is-an-Action" class="headerlink" title="What is an Action?"></a>What is an Action?</h2><p>Actions are the building blocks of Stellar, the basic units of the framework. A Stellar project is a repository containing one or more actions. An action can be invoked directly by a client or internally by other actions. Actions can receive a set of inputs and return a set of outputs. Actions can be marked private so that they can only be called by other actions and not by the client. Actions can also be overridden by other modules, unless they are marked as protected.</p>
<p>Developers can create their own actions by creating a new file in a module’s <code>actions</code> folder, or they can use the <code>stellar</code> command-line tool to generate the file and its contents automatically (<code>stellar makeAction &lt;name_of_action&gt; --module=&lt;module_which_contains_action&gt;</code>).</p>
<p>The actions are loaded into the Stellar Engine when it starts. Actions can be invoked by other actions (including those in other modules).</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">exports.randomNumber = &#123;</div><div class="line">  name: <span class="string">'randomNumber'</span>,</div><div class="line">  description: <span class="string">'Generate a random number'</span>,</div><div class="line">  outputExample: &#123;</div><div class="line">    number: <span class="number">0.40420848364010453</span></div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  run: (api, action, next) =&gt; &#123;</div><div class="line">    <span class="comment">// generate a random number</span></div><div class="line">    <span class="keyword">var</span> number = <span class="built_in">Math</span>.random()</div><div class="line"></div><div class="line">    <span class="comment">// save the generated number in an output parameter</span></div><div class="line">    action.response.number = number</div><div class="line"></div><div class="line">    <span class="comment">// returns a formatted string</span></div><div class="line">    action.response.formattedNumber = <span class="string">`Your random number is <span class="subst">$&#123;number&#125;</span>`</span></div><div class="line"></div><div class="line">    <span class="comment">// finish the action execution</span></div><div class="line">    next()</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>An action is composed of two mandatory properties: <code>name</code> identifies the action, and <code>run</code> is a function which implements the action logic.  Actions can contain other information such as a description, input value restrictions, middleware, and an output example.  Stellar can use this metadata to generate fully automatic documentation for all the actions in a project; this is especially useful for large projects with big development teams.</p>
<p>In the code snippet above you can see the structure of an action which generates a random number.</p>
<p>Actions are asynchronous and receive a reference to an <code>api</code> object (providing access to shared functions of the Engine), an <code>action</code> object, and a <code>next</code> callback function. To complete the execution of an action, simply call the <code>next()</code> function. An instance of <code>Error</code> can be passed as an argument to the <code>next</code> function; in this case, an error message will be sent to the client.</p>
<p>Actions can be invoked by other actions; this allows an action’s code to be reused for different usage scenarios.</p>
<h2 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h2><p>All properties that can appear in actions are listed below:</p>
<ul>
<li><strong><code>name</code></strong>: A unique action identifier. It is recommended to use a namespace to eliminate the possibility of collision; for example, <code>auth::login</code>.</li>
<li><strong><code>description</code></strong>: Describes the action.  This information is used in automatic documentation.</li>
<li><strong><code>inputs</code></strong>: Enumerates the action’s input parameters. You can also apply restrictions on input values.</li>
<li><strong><code>middleware</code></strong>: Indicates the middleware to be applied before and after the execution of the action. Global middleware is automatically applied.</li>
<li><strong><code>outputExample</code></strong>: Contains an example of an action response. This example will be used in automatic documentation.</li>
<li><strong><code>blockedConnectionTypes</code></strong>: Blocks certain types of connections.</li>
<li><strong><code>logLevel</code></strong>: Defines how the action should be logged.</li>
<li><strong><code>protected</code></strong>: When <code>true</code>, prevents the action from being overridden by a higher priority module.</li>
<li><strong><code>private</code></strong>: When <code>true</code>, the action can only be called internally.</li>
<li><strong><code>toDocument</code></strong>: By default, this property is set to <code>true</code>; otherwise documentation will not be generated for this action.</li>
<li><strong><code>run</code></strong>: The function which implements the logic of the action. It receives three input parameters <code>(api, action, next)</code>.</li>
</ul>
<blockquote>
<p>Note: Some of the metadata, as in the case of <code>outputExample</code> and <code>description</code>, are used only to generate the automatic documentation.</p>
</blockquote>
<h2 id="Versions"><a href="#Versions" class="headerlink" title="Versions"></a>Versions</h2><p>Stellar supports multiple versions of the same action. This allows you to create a new action with the same name as an existing action, but with improved features. This is useful when there are many existing client applications that use the API; you can update your actions without fear of breaking older versions and clients can individually update to the new API without service interruption in other clients.</p>
<p>Actions can optionally contain a <code>version</code> property. When a client makes a request, it can set the <code>apiversion</code> parameter to ask for a specific version of the action.</p>
<blockquote>
<p>Note: When no <code>apiVersion</code> parameter is defined, Stellar will respond with the latest version of the action.</p>
</blockquote>
<h2 id="Input-Declaration"><a href="#Input-Declaration" class="headerlink" title="Input Declaration"></a>Input Declaration</h2><p>In the action declaration you can specify the input fields using the <code>inputs</code> property; this will apply restrictions to the input values. These restrictions can be validators already defined in the system, a regular expression, or a function which returns a boolean (where <code>true</code> indicates that the input value is valid). Finally, you can also convert input values to a specific data type (integer, float, and string) or use a function to format the value.</p>
<p>The list below shows all available properties to use on the input fields:</p>
<ul>
<li><strong><code>required</code></strong>: Indicates whether the parameter is required.</li>
<li><strong><code>convertTo</code></strong>: Allows you to convert the parameter to a specific data type or format.</li>
<li><strong><code>default</code></strong>: Default value if the parameter is not present in the set of inputs provided by the client.</li>
<li><strong><code>validator</code></strong>: Validates the parameter using one or more constraints.</li>
</ul>
<h2 id="Parameter-Conversions"><a href="#Parameter-Conversions" class="headerlink" title="Parameter Conversions"></a>Parameter Conversions</h2><p>To remove the need for developers to manually convert input parameters to their required type, Stellar provides a way to convert them automatically before performing the action. The <code>convertTo</code> property can be a string with the values (<code>string</code>, <code>integer</code> or <code>float</code>) or a function (<code>(api, value)</code>).</p>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><p>The example below shows the conversion of a parameter to the integer type:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">exports.giveAge = &#123;</div><div class="line">  name: <span class="string">'giveAge'</span>,</div><div class="line">  description: <span class="string">'Give the name and age based on the year of birth'</span>,</div><div class="line"></div><div class="line">  inputs: &#123;</div><div class="line">    name: &#123;</div><div class="line">      required: <span class="literal">true</span></div><div class="line">    &#125;,</div><div class="line">    birthYear: &#123;</div><div class="line">      required: <span class="literal">true</span>,</div><div class="line">      convertTo: ‘integer’</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line"></div><div class="line">  run: (api, action, next) =&gt; &#123;</div><div class="line">    <span class="comment">// calculate the person's age (action.params.birthYear is already a number)</span></div><div class="line">    <span class="keyword">let</span> age = <span class="keyword">new</span> <span class="built_in">Date</span>().getFullYear() - action.params.birthYear</div><div class="line"></div><div class="line">    <span class="comment">// return a phrase with the name and age</span></div><div class="line">    action.response.result = <span class="string">`<span class="subst">$&#123;action.params.name&#125;</span> is aged <span class="subst">$&#123;age&#125;</span> years`</span></div><div class="line"></div><div class="line">    <span class="comment">// finish the action execution</span></div><div class="line">    next()</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Action-Parameter"><a href="#Action-Parameter" class="headerlink" title="Action Parameter"></a>Action Parameter</h2><p>The second parameter of the <code>run</code> function is the <code>action</code> object. This object captures the state of the connection at the time the action was started. Middleware preprocessors have already fired, and input formatting and validation has already occurred. The image below shows some of the properties of the <code>action</code> object:</p>
<p><img src="/images/action_obj.png" alt="Properties of the Action Object"></p>
<p>The goal of most actions is to perform a series of operations and change the <code>action.response</code> property, which will later be sent to the client. You can modify the connection properties by accessing <code>action.connection</code>, and change, for example, the HTTP headers. If you do not want the Engine to send a response to the client (for example, it has already sent a file), set the <code>action.toRender</code> property to <code>false</code>.</p>
<h2 id="Internal-Calls"><a href="#Internal-Calls" class="headerlink" title="Internal Calls"></a>Internal Calls</h2><p>In order to improve code reuse when actions partially share the same logic, Stellar implements a mechanism to make internal calls to actions. This means that you can extract part of the logic of one (or more) actions into simpler actions, which may also be used by other actions. Thus, from the composition of simple actions you can create more complex actions without making the code difficult to maintain.</p>
<p>To call an action internally, use the <code>api.actions.call(actionName, params, callback)</code> method:</p>
<ul>
<li><strong><code>actionName</code></strong>: Action name to call;</li>
<li><strong><code>params</code></strong>: Parameters to be passed to the action.</li>
<li><strong><code>callback(error, response)</code></strong>: Callback function.<ul>
<li><strong><code>error</code></strong>: <code>Error</code> returned by the action call.</li>
<li><strong><code>response</code></strong>: Object with the action response.</li>
</ul>
</li>
</ul>
<h3 id="Private-Actions"><a href="#Private-Actions" class="headerlink" title="Private Actions"></a>Private Actions</h3><p>Sometimes you might create actions that you do not want to be called by clients, because they are for internal use only. They don’t provide useful operations to the clients by themselves, or they are critical functions which should not have public exposure. For that Stellar allows you to define an action as private, so it can only be called internally. To make an action private, simply include the <code>private: true</code> property in the target action.</p>
<h3 id="Example-1"><a href="#Example-1" class="headerlink" title="Example"></a>Example</h3><p>The example below shows an internal call to an action called <code>sumANumber</code>; after execution, the result is printed out to the console. The complete example can be found <a href="https://github.com/StellarFw/stellar/blob/dev/example/modules/test/actions/internalCalls.js" target="_blank" rel="external">here</a>.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">api.actions.call(<span class="string">'sumANumber'</span>, &#123;a: <span class="number">3</span>, b: <span class="number">3</span>&#125;, (error, response) =&gt; &#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">`Result =&gt; <span class="subst">$&#123;response.formatted&#125;</span>`</span>)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<blockquote>
<p>Note: you can also call actions from tasks or listeners.</p>
</blockquote>
<h2 id="Automatic-Documentation"><a href="#Automatic-Documentation" class="headerlink" title="Automatic Documentation"></a>Automatic Documentation</h2><p>Stellar can generate documentation fully automatically. The required information is extracted from the actions’ properties. To avoid generating documentation for an action, you must add <code>toDocument: false</code> to the action in question; if you want disable documentation for all actions you can set the <code>api.config.general.generateDocumentation</code> setting to <code>false</code>. To access the documentation just visit the URL <code>docs/index.html</code> on the HTTP server.</p>
<p><img src="/images/auto_docs.png" alt="Automatic Documentation"></p>
<p>The image above shows an example of Stellar’s automatically generated documentation. In the sidebar are all existing actions in the project, including private actions. In the section on the right you can see details of the selected action such as name, description, input fields with their restrictions, and an output example. When actions have multiple versions, all of the versions are displayed.</p>
<h2 id="Middleware"><a href="#Middleware" class="headerlink" title="Middleware"></a>Middleware</h2><p>You can apply middleware to your actions (before and after the action is performed). Middleware can be global (applied to all actions) or defined specifically for each action using the <code>middleware</code> property, providing the name of each piece of middleware to apply to that action.</p>
<p>You can learn more about <a href="middleware.html">middleware here</a>.</p>
<h3 id="Example-2"><a href="#Example-2" class="headerlink" title="Example"></a>Example</h3><p>The following example shows the declaration of an action that contains two middleware components:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">exports.getAllAccounts = &#123;</div><div class="line">  name: <span class="string">'getAllAccounts'</span>,</div><div class="line">  description: <span class="string">'Get all registered accounts'</span>,</div><div class="line"></div><div class="line">  middleware: [<span class="string">'auth'</span>, <span class="string">'superResponse'</span>],</div><div class="line"></div><div class="line">  run: (api, action, next) =&gt; &#123;</div><div class="line">    <span class="comment">// perform some operation...</span></div><div class="line"></div><div class="line">    <span class="comment">// finish action execution</span></div><div class="line">    next()</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>


  
      <div class="guide-links">
        
          <span>← <a href="/guide/installation.html">Installation</a></span>
        
        
          <span style="float:right"><a href="/guide/models.html">Models</a> →</span>
        
      </div>
    

    <div class="footer">
      Caught a mistake or want to contribute to documentation?
      <a href="https://github.com/gil0mendes/pt.stellar-framework.com/tree/master/src/guide/actions.md" target="_blank">
        Edit this page on Github!
      </a>
    </div>
</div>

        
      </div>

      <script src="/js/smooth-scroll.min.js"></script>
      <script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
      <script src="/js/common.js"></script>
    

    <!-- enable FastClick  -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        FastClick.attach(document.body)
      }, false)
    </script>
  </body>
</html>
