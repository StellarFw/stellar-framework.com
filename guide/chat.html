
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Chat - Stellar</title>
    <meta charset="utf-8">
    <meta name="description" content="Stellar is an action based web framework for creating Web APIs easily!">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Chat - Stellar">
    <meta property="og:description" content="Stellar is an action based web framework for creating Web APIs easily!">
    <meta property="og:image" content="https://stellar-framework.com/images/logo.png">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Chat - Stellar">
    <meta name="twitter:description" content="Stellar is an action based web framework for creating Web APIs easily!">
    <meta name="twitter:image" content="https://stellar-framework.com/images/logo.png">

    <link rel="icon" href="/images/logo.png" type="image/x-icon">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Roboto Mono' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Dosis:500' rel='stylesheet' type='text/css'>

    <!-- main page styles -->
    <link rel="stylesheet" href="/css/page.css">

    <!-- this needs to be loaded before guide's inline scripts -->
    <script>window.PAGE_TYPE = 'guide'</script>
  </head>
  <body class="docs">    <div id="mobile-bar" >
      <a class="menu-button"></a>
      <a class="logo" href="/"></a>
    </div>

    <div id="header">
    <a id="logo" href="/">
        <img src="/images/logo.png">
        <span>Stellar</span>
    </a>
    <ul id="nav">
        <li>
  <form id="search-form">
    <input type="text" id="search-query-nav" class="search-query st-default-search-input">
  </form>
</li>
<li><a href="/guide/" class="nav-link current">Guide</a></li>
<li class="nav-dropdown-container">
  <a class="nav-link">Community</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://github.com/stellarFw/stellar" class="nav-link" target="_blank">GitHub</a></li>
    <li><a href="https://gitter.im/StellarFw/StellarFw" class="nav-link" target="_blank">Chat</a></li>
    <li><a href="https://twitter.com/gil0mendes" class="nav-link" target="_blank">Twitter</a></li>
  </ul>
</li>

<li class="nav-dropdown-container ecosystem">
  <a class="nav-link">Ecosystem</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://github.com/StellarFw/Identify" class="nav-link" target="_blank">Identify</a></li>
  </ul>
</li>


    </ul>
</div>

    
      <div id="main" class="fix-sidebar">
        
          
  <div class="sidebar">
  <ul class="main-menu">
    <li>
  <form id="search-form">
    <input type="text" id="search-query-sidebar" class="search-query st-default-search-input">
  </form>
</li>
<li><a href="/guide/" class="nav-link current">Guide</a></li>
<li class="nav-dropdown-container">
  <a class="nav-link">Community</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://github.com/stellarFw/stellar" class="nav-link" target="_blank">GitHub</a></li>
    <li><a href="https://gitter.im/StellarFw/StellarFw" class="nav-link" target="_blank">Chat</a></li>
    <li><a href="https://twitter.com/gil0mendes" class="nav-link" target="_blank">Twitter</a></li>
  </ul>
</li>

<li class="nav-dropdown-container ecosystem">
  <a class="nav-link">Ecosystem</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://github.com/StellarFw/Identify" class="nav-link" target="_blank">Identify</a></li>
  </ul>
</li>


  </ul>
  <div class="list">
    <div class="main-sponsor"></div>
    <a class="become-backer" href="/support-stellar">
      Become a Backer
    </a>

    <ul class="menu-root">
      
        <li>
          <a href="/guide/index.html" class="sidebar-link">Overview</a>
        </li>
      
        <li>
          <a href="/guide/installation.html" class="sidebar-link">Installation</a>
        </li>
      
        <li>
          <a href="/guide/actions.html" class="sidebar-link">Actions</a>
        </li>
      
        <li>
          <a href="/guide/models.html" class="sidebar-link">Models</a>
        </li>
      
        <li>
          <a href="/guide/tasks.html" class="sidebar-link">Tasks</a>
        </li>
      
        <li>
          <a href="/guide/middleware.html" class="sidebar-link">Middleware</a>
        </li>
      
        <li>
          <a href="/guide/satellites.html" class="sidebar-link">Satellites</a>
        </li>
      
        <li>
          <a href="/guide/cluster.html" class="sidebar-link">Cluster</a>
        </li>
      
        <li>
          <a href="/guide/cache.html" class="sidebar-link">Cache</a>
        </li>
      
        <li>
          <a href="/guide/chat.html" class="sidebar-link current">Chat</a>
        </li>
      
        <li>
          <a href="/guide/development_mode.html" class="sidebar-link">Development Mode</a>
        </li>
      
        <li>
          <a href="/guide/file_system.html" class="sidebar-link">File System</a>
        </li>
      
        <li>
          <a href="/guide/events.html" class="sidebar-link">Events</a>
        </li>
      
        <li>
          <a href="/guide/websocket.html" class="sidebar-link">WebSocket</a>
        </li>
      
        <li>
          <a href="/guide/tcp.html" class="sidebar-link">TCP</a>
        </li>
      
        <li>
          <a href="/guide/http.html" class="sidebar-link">HTTP</a>
        </li>
      
        <li>
          <a href="/guide/security.html" class="sidebar-link">Security</a>
        </li>
      
        <li>
          <a href="/guide/validation.html" class="sidebar-link">Validation</a>
        </li>
      
        <li>
          <a href="/guide/logging.html" class="sidebar-link">Logging</a>
        </li>
      
        <li>
          <a href="/guide/commands.html" class="sidebar-link">Commands</a>
        </li>
      
    </ul>
  </div>
</div>



<div class="content guide with-sidebar chat-guide">
  
    <h1>Chat</h1>
  

  <h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>Stellar ships with a chat framework which may be used by all persistent connections (TCP and WebSocket). There are methods to create and manage chat rooms and control the users in those rooms. Chat does not have to represent peer-to-peer communications - it is a metaphor used for many things, including game state in multiplayer games.</p>
<p>Clients themselves interact with rooms via <code>verbs</code>. Verbs are short-form commands that will attempt to modify the connection’s state, either joining or leaving a room. Clients can be in many rooms ate once. The most relevant chat verbs are:</p>
<ul>
<li><code>roomAdd</code></li>
<li><code>roomLeave</code></li>
<li><code>roomView</code></li>
<li><code>say</code></li>
</ul>
<p>This feature can be used out-of-the-box without any additional packages, configuration or programming. By default, a room named “defaultRoom” is created when the framework starts. When the WebSocket server is active it generates a client script that can be used in web applications to facilitate calling actions and communicating with the chat rooms.</p>
<blockquote>
<p>Warning: There is no limit on the number of rooms which can be created, but keep in mind that each room stores information in Redis, and each connection requires additional resources as well.</p>
</blockquote>
<h2 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h2><p>These methods can be used within your server. They are not exposed directly to clients, but they can be used within an action or a satellite.</p>
<h3 id="Broadcast"><a href="#Broadcast" class="headerlink" title="Broadcast"></a>Broadcast</h3><p>The <code>api.chatRoom.broadcast(connection, room, message, callback)</code> method allows you to send a message to all members in a room. The connection parameter can be a real connection (a message coming from a client), or a mockConnection. A mockConnection at the very least has the form <code>{room: &#39;someRoom&#39;}</code>. When an ID is not specified the ID will be assigned to 0.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">api.chatRoom.broadcast(&#123;room: <span class="string">'general'</span>&#125;, <span class="string">'general'</span>, <span class="string">'Hello!'</span>, error =&gt; &#123;</div><div class="line">  <span class="comment">// do something after sending the message!</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="List-of-Rooms"><a href="#List-of-Rooms" class="headerlink" title="List of Rooms"></a>List of Rooms</h3><p>The <code>api.chatRoom.list(callback)</code> allows you to get a list of existing rooms. The following example code lists all rooms in the console (<code>stdout</code>):</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">api.chatRoom.list((error, rooms) =&gt; &#123;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> k <span class="keyword">in</span> rooms) &#123; <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;k&#125;</span> =&gt; <span class="subst">$&#123;rooms[k]&#125;</span>`</span>) &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="Create-a-Room"><a href="#Create-a-Room" class="headerlink" title="Create a Room"></a>Create a Room</h3><p>To create a room you use the <code>api.chatRoom.add(room, callback)</code> method. The callback function receives a parameter that has a value of <code>0</code> when the room already exists and <code>1</code> if it has just been created. The following code shows the creation of a new room named “labs”:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">api.chatRoom.add(<span class="string">'labs'</span>, res =&gt; &#123;</div><div class="line">  <span class="keyword">if</span> (res === <span class="number">0</span>) &#123;</div><div class="line">    <span class="comment">// the room already exists!</span></div><div class="line">    <span class="keyword">return</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// the room has been created!</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="Remove-a-Room"><a href="#Remove-a-Room" class="headerlink" title="Remove a Room"></a>Remove a Room</h3><p>Using the <code>api.chatRoom.destroy(room, callback)</code> method, you can remove a room. The callback function does not receive any parameters; the room is always removed. The following code shows how you can remove a room:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">api.chatRoom.destroy(<span class="string">'labs'</span>, () =&gt; &#123;</div><div class="line">  <span class="comment">// room removed!</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="Check-if-the-Room-Exists"><a href="#Check-if-the-Room-Exists" class="headerlink" title="Check if the Room Exists"></a>Check if the Room Exists</h3><p>You can use the <code>api.chatRoom.exists(room, callback)</code> method to check if the room exists in the Stellar instance. The <code>callback(error, found)</code> receives two parameters:</p>
<ul>
<li><strong><code>error</code></strong>: Assumes the <code>null</code> value if there are no problems.</li>
<li><strong><code>found</code></strong>: <code>true</code> if the room exists, <code>false</code> otherwise.</li>
</ul>
<p>The following code checks the existence of the chat room named “coffeeTable”:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">api.chatRoom.exists(<span class="string">'coffeeTable'</span>, (error, found) =&gt; &#123;</div><div class="line">  <span class="keyword">if</span> (!found) &#123;</div><div class="line">    <span class="comment">// the room does not exist!</span></div><div class="line">    <span class="keyword">return</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// the room exists!</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="Gets-the-Room-State"><a href="#Gets-the-Room-State" class="headerlink" title="Gets the Room State"></a>Gets the Room State</h3><p>With the <code>api.chatRoom.roomStatus(room, callback)</code> method you can get room status information. The <code>callback(error, state)</code> function takes two parameters:</p>
<ul>
<li><strong><code>error</code></strong>: <code>null</code> if no error occurs during the method call.</li>
<li><strong><code>state</code></strong>: An object containing information about the room: name, number of registered members, and the list of such members.</li>
</ul>
<p>The code below shows how this information can be obtained and then a possible result:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">api.chatRoom.roomStatus(<span class="string">'Random'</span>, (error, status) =&gt; &#123;</div><div class="line">  <span class="comment">// do something with the room information!</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">&#123;</div><div class="line">  room: <span class="string">'Random'</span>,</div><div class="line">  membersCount: <span class="number">3</span>,</div><div class="line">  members: &#123;</div><div class="line">    g0m: &#123;id: <span class="string">'g0m'</span>, joinedAt: <span class="number">1465829955</span>&#125;,</div><div class="line">    afls: &#123;id: <span class="string">'afls'</span>, joinedAt: <span class="number">1465829985</span>&#125;,</div><div class="line">    amg: &#123;id: <span class="string">'amg'</span>, joinedAt: <span class="number">1465830011</span>&#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Add-a-Member"><a href="#Add-a-Member" class="headerlink" title="Add a Member"></a>Add a Member</h3><p>To add a new member, use the <code>api.chatRoom.addMember(connectionId, room, callback)</code> method.  The client connection ID and the name of the room are needed. The <code>callback(error, wasAdded)</code> function takes two parameters:</p>
<ul>
<li><strong><code>error</code></strong>: <code>null</code> if no error occurs during the call.</li>
<li><strong><code>wasAdded</code></strong>: Can be <code>true</code> or <code>false</code> depending on whether the member was added or not.</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">api.chatRoom.addMember(connectionId, <span class="string">'newUsers'</span>, (error, wasAdded) =&gt; &#123;</div><div class="line">  <span class="keyword">if</span> (!wasAdded) &#123;</div><div class="line">    <span class="comment">// could not add the new member!</span></div><div class="line">    <span class="keyword">return</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// client added as a new member!</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<blockquote>
<p>Note: you can add connections from the current server or any other server in the cluster.</p>
</blockquote>
<h3 id="Remove-a-Member"><a href="#Remove-a-Member" class="headerlink" title="Remove a Member"></a>Remove a Member</h3><p>The <code>api.chatRoom.removeMember(connectionId, room, callback)</code> method allows you to remove a member of a given room. This requires the member’s connection ID and the name of the room. The <code>callback(error wasRemoved)</code> function takes two parameters:</p>
<ul>
<li><strong><code>error</code></strong>: <code>null</code> if no error occurs during the operation.</li>
<li><strong><code>wasRemoved</code></strong>: <code>true</code> if the member has been removed, <code>false</code> otherwise.</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">api.chatRoom.removeMember(connectionId, <span class="string">'heaven'</span>, (error, wasRemoved) =&gt; &#123;</div><div class="line">  <span class="keyword">if</span> (!wasRemoved) &#123;</div><div class="line">    <span class="comment">// the member has not been removed!</span></div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// the member was removed from the room!</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<blockquote>
<p>Note: you can remove connections from the current server or any other server in the cluster.</p>
</blockquote>
<h2 id="Middleware"><a href="#Middleware" class="headerlink" title="Middleware"></a>Middleware</h2><p>There are 4 types of middleware you can install for the chat system: <code>say</code>, <code>onSayReceive</code>, <code>join</code>, and <code>leave</code>. All documentation about <em>middleware</em> is available in the <a href="./middleware.html">middleware section</a>.</p>
<h2 id="Chatting-to-Specific-Clients"><a href="#Chatting-to-Specific-Clients" class="headerlink" title="Chatting to Specific Clients"></a>Chatting to Specific Clients</h2><p>Every connection object also has a <code>connection.sendMessage(message)</code> method which you can call directly from the server.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">connectionObj.sendMessage(<span class="string">'Welcome to Stellar :)'</span>)</div></pre></td></tr></table></figure>
<h2 id="Client-Functions"><a href="#Client-Functions" class="headerlink" title="Client Functions"></a>Client Functions</h2><p>The ways it is possible to communicate with the client are described in the sections documenting the types of bidirectional servers, <a href="websocket.html">websocket</a> and <a href="tcp.html">TCP</a>.</p>


  
      <div class="guide-links">
        
          <span>← <a href="/guide/cache.html">Cache</a></span>
        
        
          <span style="float:right"><a href="/guide/development_mode.html">Development Mode</a> →</span>
        
      </div>
    

    <div class="footer">
      Caught a mistake or want to contribute to documentation?
      <a href="https://github.com/StellarFw/stellar-framework.com/tree/master/src/guide/chat.md" target="_blank">
        Edit this page on Github!
      </a>
    </div>
</div>

        
      </div>
      <script src="/js/smooth-scroll.min.js"></script>
    

    <!-- search -->
    <link href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/css/search.css">
    <script src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js" type="text/javascript"></script>

    <!-- main custom script for sidebar and other cool things -->
    <script src="/js/common.js"></script>

    <!-- ga -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-77611901-1', 'stellar-framework.com');
      ga('send', 'pageview');
    </script>

    <!-- fastclick  -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        FastClick.attach(document.body)
      }, false)
    </script>
  </body>
</html>
