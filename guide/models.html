
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Models - Stellar</title>
    <meta charset="utf-8">
    <meta name="description" content="Stellar is an action based web framework for creating Web APIs easily!">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <meta property="og:type" content="article">
    <meta property="og:title" content="Models - Stellar">
    <meta property="og:description" content="Stellar is an action based web framework for creating Web APIs easily!">
    <meta property="og:image" content="https://stellar-framework.com/images/logo.png">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Models - Stellar">
    <meta name="twitter:description" content="Stellar is an action based web framework for creating Web APIs easily!">
    <meta name="twitter:image" content="https://stellar-framework.com/images/logo.png">

    <link rel="icon" href="/images/logo.png" type="image/x-icon">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600|Roboto Mono' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Dosis:500' rel='stylesheet' type='text/css'>

    <!-- main page styles -->
    <link rel="stylesheet" href="/css/page.css">

    <!-- this needs to be loaded before guide's inline scripts -->
    <script>window.PAGE_TYPE = 'guide'</script>
  </head>
  <body class="docs">    <div id="mobile-bar" >
      <a class="menu-button"></a>
      <a class="logo" href="/"></a>
    </div>

    <div id="header">
    <a id="logo" href="/">
        <img src="/images/logo.png">
        <span>Stellar</span>
    </a>
    <ul id="nav">
        <li>
  <form id="search-form">
    <input type="text" id="search-query-nav" class="search-query st-default-search-input">
  </form>
</li>
<li><a href="/guide/" class="nav-link current">Guide</a></li>
<li class="nav-dropdown-container">
  <a class="nav-link">Community</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://github.com/stellarFw/stellar" class="nav-link" target="_blank">GitHub</a></li>
    <li><a href="https://gitter.im/StellarFw/StellarFw" class="nav-link" target="_blank">Chat</a></li>
    <li><a href="https://twitter.com/gil0mendes" class="nav-link" target="_blank">Twitter</a></li>
  </ul>
</li>

<li class="nav-dropdown-container ecosystem">
  <a class="nav-link">Ecosystem</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://github.com/StellarFw/Identify" class="nav-link" target="_blank">Identify</a></li>
  </ul>
</li>


    </ul>
</div>

    
      <div id="main" class="fix-sidebar">
        
          
  <div class="sidebar">
  <ul class="main-menu">
    <li>
  <form id="search-form">
    <input type="text" id="search-query-sidebar" class="search-query st-default-search-input">
  </form>
</li>
<li><a href="/guide/" class="nav-link current">Guide</a></li>
<li class="nav-dropdown-container">
  <a class="nav-link">Community</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://github.com/stellarFw/stellar" class="nav-link" target="_blank">GitHub</a></li>
    <li><a href="https://gitter.im/StellarFw/StellarFw" class="nav-link" target="_blank">Chat</a></li>
    <li><a href="https://twitter.com/gil0mendes" class="nav-link" target="_blank">Twitter</a></li>
  </ul>
</li>

<li class="nav-dropdown-container ecosystem">
  <a class="nav-link">Ecosystem</a><span class="arrow"></span>
  <ul class="nav-dropdown">
    <li><a href="https://github.com/StellarFw/Identify" class="nav-link" target="_blank">Identify</a></li>
  </ul>
</li>


  </ul>
  <div class="list">
    <div class="main-sponsor"></div>
    <a class="become-backer" href="/support-stellar">
      Become a Backer
    </a>

    <ul class="menu-root">
      
        <li>
          <a href="/guide/index.html" class="sidebar-link">Overview</a>
        </li>
      
        <li>
          <a href="/guide/installation.html" class="sidebar-link">Installation</a>
        </li>
      
        <li>
          <a href="/guide/actions.html" class="sidebar-link">Actions</a>
        </li>
      
        <li>
          <a href="/guide/models.html" class="sidebar-link current">Models</a>
        </li>
      
        <li>
          <a href="/guide/tasks.html" class="sidebar-link">Tasks</a>
        </li>
      
        <li>
          <a href="/guide/middleware.html" class="sidebar-link">Middleware</a>
        </li>
      
        <li>
          <a href="/guide/satellites.html" class="sidebar-link">Satellites</a>
        </li>
      
        <li>
          <a href="/guide/cluster.html" class="sidebar-link">Cluster</a>
        </li>
      
        <li>
          <a href="/guide/cache.html" class="sidebar-link">Cache</a>
        </li>
      
        <li>
          <a href="/guide/chat.html" class="sidebar-link">Chat</a>
        </li>
      
        <li>
          <a href="/guide/development_mode.html" class="sidebar-link">Development Mode</a>
        </li>
      
        <li>
          <a href="/guide/file_system.html" class="sidebar-link">File System</a>
        </li>
      
        <li>
          <a href="/guide/events.html" class="sidebar-link">Events</a>
        </li>
      
        <li>
          <a href="/guide/websocket.html" class="sidebar-link">WebSocket</a>
        </li>
      
        <li>
          <a href="/guide/tcp.html" class="sidebar-link">TCP</a>
        </li>
      
        <li>
          <a href="/guide/http.html" class="sidebar-link">HTTP</a>
        </li>
      
        <li>
          <a href="/guide/security.html" class="sidebar-link">Security</a>
        </li>
      
        <li>
          <a href="/guide/validation.html" class="sidebar-link">Validation</a>
        </li>
      
        <li>
          <a href="/guide/logging.html" class="sidebar-link">Logging</a>
        </li>
      
        <li>
          <a href="/guide/commands.html" class="sidebar-link">Commands</a>
        </li>
      
    </ul>
  </div>
</div>



<div class="content guide with-sidebar models-guide">
  
    <h1>Models</h1>
  

  <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>The model system included with Stellar provides a straight-forward, schema-based solution to model your application data. It includes built-in type casting, validation, query building, business logic hooks and more, out of the box. All to work with you database.</p>
<p>Each database collection has a corresponding “Model” which is used to interact with that collection. Models allow you to query for data in your collections, as well as insert new records into the collection.</p>
<p>Before getting started, be sure to configure a database connection in <code>config/database.js</code>. For more information on configuring your database, check out the documentation.</p>
<blockquote>
<p>Note: For now, Stellar only support MongoDB servers.</p>
</blockquote>
<h2 id="Configuration"><a href="#Configuration" class="headerlink" title="Configuration"></a>Configuration</h2><p>The database configuration for your application is located at <code>config/database.js</code>, but you can choose some other name, we use this to better know what configs are inside the file. If you do not configure it an in-memory database will be used, this is done to provide to you a out of the box way to start developing your API without hurry about configurations and is a mock for testing environment.</p>
<p>There is two parameter that you can configure:</p>
<ul>
<li><strong><code>connectionString</code></strong>: The connection string to be passed to connection package;</li>
<li><strong><code>pkg</code></strong>: The connection package to use in the connection with the database. This can assume two values (<code>mongoose</code>, <code>mockgose</code>).</li>
</ul>
<p>The follow code show a example config to connect with a remote MongoDB server on the MLab servers, in the development environment:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"></div><div class="line"><span class="comment">// use a remote MongoDB server on development</span></div><div class="line">exports.development = &#123;</div><div class="line">  models: api =&gt; &#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">      connectionString: <span class="string">'mongodb://exampleUser:examplePass@dz010866.mlab.com:19876/myOpDatabase'</span>,</div><div class="line">      pkg: <span class="string">'mongoose'</span></div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Defining-Models"><a href="#Defining-Models" class="headerlink" title="Defining Models"></a>Defining Models</h2><p>To get started, let’s create an model. Models live in the <code>models</code> directory on the modules root.</p>
<p>The easiest way to create a model instance is using the <code>makeModel</code> command:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">stellar makeModel User --module=authentication</div></pre></td></tr></table></figure>
<p>If you would like to generate a CRUD action when you generate the model, you may use the –crud option:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">stellar makeModel User ---module=authentication --crud</div></pre></td></tr></table></figure>
<blockquote>
<p>NOTE: the generated code uses the function syntax. You can see more about that on the next subsection.</p>
</blockquote>
<p>All the models are loaded into memory when a new Stellar instance is started, so you have a global place where all the models living (<code>api.models</code>). Ahead will be able to see how to get a model an use it on your code.</p>
<h2 id="Model-Conventions"><a href="#Model-Conventions" class="headerlink" title="Model Conventions"></a>Model Conventions</h2><p>Now, let’s look at an example <code>Content</code> model, which we will use to retrieve and store information from our <code>contents</code> database collection:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"></div><div class="line">exports.default = &#123;</div><div class="line">  title:   <span class="built_in">String</span>,</div><div class="line">  content: <span class="built_in">String</span>,</div><div class="line">  source:  <span class="built_in">String</span>,</div><div class="line">  tags:    [ <span class="built_in">String</span> ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>Note: You must use the Mongoose syntax to define your models.</p>
</blockquote>
<p>For more advanced models you can use a function instead of an <code>Object</code>:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="meta">'use strict'</span></div><div class="line"></div><div class="line">exports.default = (api, mongoose) =&gt; &#123;</div><div class="line">  <span class="comment">// get Schema type</span></div><div class="line">  <span class="keyword">let</span> Schema = mongoose.Schema</div><div class="line"></div><div class="line">  <span class="comment">// return the schema</span></div><div class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Schema(&#123;</div><div class="line">    _creator: &#123; type: Schema.Types.ObjectId, ref: <span class="string">'question'</span> &#125;,</div><div class="line">    content: <span class="built_in">String</span>,</div><div class="line">    user: Schema.Types.Mixed</div><div class="line">  &#125;, &#123;</div><div class="line">    timestamps: <span class="literal">true</span></div><div class="line">  &#125;)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Retrieving-Models"><a href="#Retrieving-Models" class="headerlink" title="Retrieving Models"></a>Retrieving Models</h2><p>Once you created a model, you are ready to start retrieving data from your database. For example:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">api.models.get(<span class="string">'question'</span>).find(&#123;&#125;, (err, resources) =&gt; &#123;</div><div class="line">  <span class="comment">// so something...</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>You can define some search parameters like this:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">api.models.get(<span class="string">'question'</span>).find(&#123; tile: <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'^Node\s*'</span>, <span class="string">"i"</span>) &#125;, (err, resources) =&gt; &#123;</div><div class="line">  <span class="comment">// so something...</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h2 id="Retrieving-Single-Models"><a href="#Retrieving-Single-Models" class="headerlink" title="Retrieving Single Models"></a>Retrieving Single Models</h2><p>Of course, in addition to retrieving all of the records for a given collection, you may also retrieve single records using <code>findOne</code>, <code>findById</code>. Instead of returning a collection of models, these method return a single model instance.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="comment">// retrieve a model by its id</span></div><div class="line">api.models.get(<span class="string">'question'</span>).findById(<span class="string">'507f1f77bcf86cd799439011'</span>, (err, resource) =&gt; &#123;</div><div class="line">  <span class="comment">// do something...</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">// retrieve the first model matching the query constraints...</span></div><div class="line">api.models.get(<span class="string">'question'</span>).findOne(&#123; active: <span class="literal">true</span> &#125;, (err, resource) =&gt; &#123;</div><div class="line">  <span class="comment">// do something...</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>When the model are not found the <code>resource</code> variable is <code>null</code>.</p>
<h2 id="Inserting-amp-Updating-Models"><a href="#Inserting-amp-Updating-Models" class="headerlink" title="Inserting &amp; Updating Models"></a>Inserting &amp; Updating Models</h2><h3 id="Inserts"><a href="#Inserts" class="headerlink" title="Inserts"></a>Inserts</h3><p>To create a new record in the database, simple create a new model instance, set attributes on the model, then call the save method:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">exports.createQuestion = &#123;</div><div class="line">  name: <span class="string">'createQuestion'</span>,</div><div class="line">  description: <span class="string">'Create a new question'</span>,</div><div class="line"></div><div class="line">  run: (api, action, next) =&gt; &#123;</div><div class="line">    <span class="keyword">const</span> QuestionModel = api.models.get(<span class="string">'question'</span>)</div><div class="line"></div><div class="line">    <span class="keyword">let</span> question = <span class="keyword">new</span> QuestionModel()</div><div class="line"></div><div class="line">    question.title = action.params.title</div><div class="line"></div><div class="line">    question.save()</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>In this example, we simply assign the title parameter from the incoming request to the name attribute of the <code>Question</code> model instance. When we call the save method, a record will be inserted into the database.</p>
<h3 id="Updates"><a href="#Updates" class="headerlink" title="Updates"></a>Updates</h3><p>The save method may also be used to update models that already exist in the database. To update a model, you should retrieve it, set any attributes you wish to update, and then call the save method.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line"><span class="keyword">let</span> question = QuestionModel.findById(<span class="string">'507f1f77bcf86cd799439011'</span>)</div><div class="line"></div><div class="line">question.content = <span class="string">'New Question Content'</span></div><div class="line"></div><div class="line">question.save()</div></pre></td></tr></table></figure>
<p>You can also rewrite the code above using the <code>findOneAndUpdate</code> method:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">QuestionModel.findOneAndUpdate(&#123; _id: <span class="string">'507f1f77bcf86cd799439011'</span> &#125;, &#123; content: <span class="string">'New Question Content'</span> &#125;)</div></pre></td></tr></table></figure>
<h4 id="Mass-Update"><a href="#Mass-Update" class="headerlink" title="Mass Update"></a>Mass Update</h4><p>Updates can also be performed against any number of models that match a given query. In this example, all question that are <code>active</code> will be marked as inactive:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">QuestionModel.update(&#123; active : <span class="literal">true</span> &#125;, &#123; active: <span class="literal">false</span> &#125;, &#123; multi: <span class="literal">true</span> &#125;)</div></pre></td></tr></table></figure>
<h2 id="Deleting-Models"><a href="#Deleting-Models" class="headerlink" title="Deleting Models"></a>Deleting Models</h2><p>To delete a model, call the delete method on a model instance:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">QuestionModel.findByIdAndRemove(<span class="string">'507f1f77bcf86cd799439011'</span>)</div></pre></td></tr></table></figure>
<h2 id="Extend-Models"><a href="#Extend-Models" class="headerlink" title="Extend Models"></a>Extend Models</h2><p>For now, there is no way to replace or modify already created models. So, in order to manipulate (add, modify or remove) fields, Stellar provides a custom event on the model insertion. The event name is <code>core.models.add.{name}</code>, <code>name</code> is dynamic and is replaced with the model name. Using this naming convention we don’t need to call all the listeners who modify models, instead of that we just call the right listeners for that specific model.</p>
<p>The <code>core.models.add.{name}</code> event receives an instance of the Mongoose Schema (<code>schema</code>), who represents the model schema, and the Mongoose instance (<code>mongoose</code>) to access, for example, to the Mongoose custom data types. To manipulate the model you must use the <a href="http://mongoosejs.com/docs/api.html#schema_Schema-add" target="_blank" rel="external">Mongoose Schema methods</a>.</p>
<p>The follow example shows how to extend a model. In this case we are adding two new fields to the <code>user</code> model:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><div class="line">exports.editUserModel = &#123;</div><div class="line">  event: <span class="string">'core.models.add.user'</span>,</div><div class="line">  description: <span class="string">'This adds the address and the phone fields to the user model'</span>,</div><div class="line"></div><div class="line">  run (api, params, next) &#123;</div><div class="line">    <span class="comment">// add the new two fields</span></div><div class="line">    params.schema.add(&#123;</div><div class="line">      address: &#123; type: <span class="built_in">String</span>, <span class="keyword">default</span>: <span class="literal">null</span> &#125;,</div><div class="line">      phone: &#123; type: <span class="built_in">String</span>, <span class="keyword">default</span>: <span class="literal">null</span> &#125;</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    <span class="comment">// finish the event execution</span></div><div class="line">    next()</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>Note that the <code>user</code> model is owned by another module (for example, the <a href="https://github.com/stellarFw/Identify" target="_blank" rel="external">Authentication module</a>).</p>
</blockquote>


  
      <div class="guide-links">
        
          <span>← <a href="/guide/actions.html">Actions</a></span>
        
        
          <span style="float:right"><a href="/guide/tasks.html">Tasks</a> →</span>
        
      </div>
    

    <div class="footer">
      Caught a mistake or want to contribute to documentation?
      <a href="https://github.com/StellarFw/stellar-framework.com/tree/master/src/guide/models.md" target="_blank">
        Edit this page on Github!
      </a>
    </div>
</div>

        
      </div>
      <script src="/js/smooth-scroll.min.js"></script>
    

    <!-- search -->
    <link href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="/css/search.css">
    <script src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js" type="text/javascript"></script>

    <!-- main custom script for sidebar and other cool things -->
    <script src="/js/common.js"></script>

    <!-- ga -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-77611901-1', 'stellar-framework.com');
      ga('send', 'pageview');
    </script>

    <!-- fastclick  -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        FastClick.attach(document.body)
      }, false)
    </script>
  </body>
</html>
